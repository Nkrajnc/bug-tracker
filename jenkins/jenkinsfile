pipeline {
  agent any

  stages {
    stage('Unit Tests - Backend') {
      agent {
        docker {
          image 'snakee/golang-junit:1.21'
          reuseNode true
        }
      }

      environment {
        GOCACHE = "/tmp/go-build"
        HOME    = "/tmp"
        GOMODCACHE= "${WORKSPACE}/.cache/go-mod"
        GOPATH    = "${WORKSPACE}/.cache/go"
      }

      steps {
        sh 'mkdir -p "$GOCACHE" "$GOMODCACHE" "$GOPATH"'
        dir('bugtracker-backend') {
          sh 'go test -v ./...'
        }
      }
    }

    stage('frontend unit tests'){
        agent {
            docker {
                image 'node:20-alpine'
                reuseNode true
            }
        }
        steps {
            dir('bugtracker-frontend') {
                sh '''
                    npm ci
                    npm test

                '''
            }
        }

    }
  }
}
